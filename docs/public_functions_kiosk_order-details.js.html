<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: public/functions/kiosk/order-details.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: public/functions/kiosk/order-details.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Represents a single order containing employee and cost details.
 * @class
 */
class Order {
    /**
     * Creates an instance of Order.
     * @param {string|number} orderId - The unique identifier for the order.
     * @param {string|number} employeeId - The ID of the employee processing the order.
     * @param {number} totalCost - The total cost of the order.
     * @param {string} timeStamp - The timestamp when the order was created.
     */
    constructor(orderId, employeeId, totalCost, timeStamp) {
        this.orderId = orderId;
        this.employeeId = employeeId;
        this.totalCost = totalCost;
        this.timeStamp = timeStamp;
    }
}

/**
 * Validates the current order stored in local storage.
 * Checks if the order requires kitchen verification (10+ items or >= $150).
 * If verification is needed, sends a request to '/notify-kitchen' and redirects to employee verification.
 * * @async
 * @returns {Promise&lt;void|string>} Redirects to '/employee-verify' if verification is successful.
 */
async function validateOrder() {
    const order = JSON.parse(localStorage.getItem('Totalorder'));
    const verified = localStorage.getItem('verified');

    if (verified === 'true') {
        return;
    }
    if (order.entries.length === 10 || order.totalPrice >= 150) {
        //send request to kitchen view
        
        const response = await fetch('/customer/notify-kitchen', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({  type: 'Verify'})
        });

        const data = await response.json();

        if (data.success) {
            alert('Kitchen has been notified for order verification.');
            return window.location.href = '/customer/employee-verify';
        }
        else {
            alert('Failed to notify kitchen: ' + data.error);
        }        
    }
}

/**
 * Window load event handler.
 * Automatically triggers order validation when the page loads.
 */
window.onload = async function() {
    await validateOrder();
};

/**
 * Prompts the user for confirmation before submitting the order.
 * If confirmed, calls submitOrder().
 * * @async
 * @returns {Promise&lt;void>}
 */
async function confirmOrder() {
    const confirmation = Boolean(localStorage.getItem('foo')) || false;
    if (confirmation) {
        await submitOrder();
    }
    else {
        openMissAnything();
    }
}

/**
 * Finalizes the order and submits it to the backend.
 * Checks if the order is empty before sending.
 * On success, clears local storage and redirects to the home page.
 * * @async
 * @returns {Promise&lt;void>}
 */
async function submitOrder() {
    const order = JSON.parse(localStorage.getItem('Totalorder'));

    if (order.entries.length === 0) {
        document.getElementById('complete-order-button').disabled = true;
        alert('Your order is empty. Please add items before completing the order.');
        return;
    }

    try {
        const response = await fetch('/customer/finalize-order', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                entries: JSON.stringify(order.entries),
                totalCost: order.totalPrice,
                orderId: JSON.parse(localStorage.getItem('orderId'))
            })
        });

        const data = await response.json();

        if (data.success) {
            localStorage.clear();
            window.location.href = '/';
        }
        else {
            alert('Failed to finalize order: ' + data.error);
        }
    } catch (error) {
        console.error('Error finalizing order:', error);
        alert('An error occurred while finalizing the order.');
    }
}

/**
 * Redirects the user to the item selection page to add more items.
 * * @async
 * @returns {Promise&lt;void>}
 */
async function orderMore() {
    window.location.href = '../customer/item-selection';
}

/**
 * Deletes a specific entry from the order based on its ID.
 * Updates the 'Totalorder' in local storage, recalculates the total price,
 * syncs with the server via '/store-order', and reloads the page.
 * * @async
 * @param {string|number} entryID - The ID of the entry to be deleted.
 * @returns {Promise&lt;void>} Reloads the window upon completion.
 */
async function deleteEntry(entryID) {
    let Totalorder = JSON.parse(localStorage.getItem('Totalorder'));

    Totalorder.entries = Totalorder.entries.filter(entry => entry.entryId != entryID);
    Totalorder.totalPrice = Totalorder.entries.reduce((sum, entry) => sum + entry.price, 0);
    localStorage.setItem('Totalorder', JSON.stringify(Totalorder));

    await fetch('/customer/store-order', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(Totalorder)
    });
    window.location.reload();

}

/**
 * Prepares an entry for editing.
 * Moves the entry to sessionStorage, removes it from the active order,
 * syncs the updated order with the server, and redirects the user to the appropriate
 * menu page based on the item size or type.
 * * @async
 * @param {string|number} entryId - The ID of the entry to be edited.
 * @returns {Promise&lt;void>} Redirects to the specific item page.
 */
async function editEntry(entryId) {
    let Totalorder = JSON.parse(localStorage.getItem('Totalorder'));

    let entry = Totalorder.entries.find(entry => entry.entryId == entryId);
    sessionStorage.setItem('editEntry', JSON.stringify(entry));
    Totalorder.entries = Totalorder.entries.filter(entry => entry.entryId != entryId);
    Totalorder.totalPrice = Totalorder.entries.reduce((sum, entry) => sum + entry.price, 0);
    localStorage.setItem('Totalorder', JSON.stringify(Totalorder));

    await fetch('/customer/store-order', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(Totalorder)
    });

    if (entry.size === 'Appetizer') {
        window.location.href = '/customer/apps?item=Appetizer';
    }
    if (entry.size === 'Drink') {
        window.location.href = '/customer/drinks?item=Drink';
    }
    if (entry.size === 'Small' || entry.size === 'Medium' || entry.size === 'Large') {
        window.location.href = '/customer/menu-items?item=Al a Carte';
    }
    else{
        window.location.href = '/customer/menu-items?item=' + entry.size;
    }
}

/**
 * Prompts the user for confirmation before cancelling the entire order.
 * If confirmed, calls submitCancellation().
 * * @async
 * @returns {Promise&lt;void>}
 */
async function cancelOrder() {
    const confirmCancel = confirm("Are you sure you want to cancel the entire order? This action cannot be undone.");
    if (confirmCancel) {
        await submitCancellation();
    }
}

/**
 * Submits a cancellation request to the backend.
 * Clears the local storage and redirects the user to the home page.
 * * @async
 * @returns {Promise&lt;void>}
 */
async function submitCancellation() {
    const orderId = JSON.parse(localStorage.getItem('orderId'));

    try {
        const response = await fetch('/customer/cancel-order', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ orderId: orderId })
        });
    } catch (error) {
        console.error('Error cancelling order:', error);
        alert('An error occurred while cancelling the order.');
    }


    localStorage.clear();
    window.location.href = '/customer';
}

function openMissAnything() {
    console.log("Opening modal");
    document.getElementById('miss-anything-modal').style.display = 'block';
    localStorage.setItem('foo', 'true');
}

function closeMissAnythingModal() {
    document.getElementById('miss-anything-modal').style.display = 'none';
}

function gotoDrinks() {
    window.location.href = '../customer/drinks?item=Drink';
}
function gotoApps() {
    window.location.href = '../customer/apps?item=Appetizer';
}

window.onclick = function(event) {
    const modal = document.getElementById('miss-anything-modal');
    if (event.target == modal) {
        modal.style.display = 'none';
    }
}

</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-API_CurrencyExchange.html">API/CurrencyExchange</a></li><li><a href="module-API_Weather.html">API/Weather</a></li><li><a href="module-routes_kitchen.html">routes/kitchen</a></li><li><a href="module-routes_manager.html">routes/manager</a></li><li><a href="module-routes_managerReportRoute_XandZReport.html">routes/managerReportRoute/XandZReport</a></li><li><a href="module-routes_managerReportRoute_managerReports.html">routes/managerReportRoute/managerReports</a></li><li><a href="module-routes_managerReportRoute_productUsageReport.html">routes/managerReportRoute/productUsageReport</a></li><li><a href="module-routes_managerReportRoute_restockReport.html">routes/managerReportRoute/restockReport</a></li><li><a href="module-routes_managerReportRoute_salesReport.html">routes/managerReportRoute/salesReport</a></li><li><a href="module-routes_managerRoute_employees.html">routes/managerRoute/employees</a></li><li><a href="module-routes_managerRoute_inventory.html">routes/managerRoute/inventory</a></li><li><a href="module-routes_managerRoute_menu.html">routes/managerRoute/menu</a></li><li><a href="module-routes_managerRoute_pricing.html">routes/managerRoute/pricing</a></li><li><a href="module-routes_managerRoute_recipes.html">routes/managerRoute/recipes</a></li><li><a href="module-routes_managerRoute_schedule.html">routes/managerRoute/schedule</a></li><li><a href="module-routes_menu=board.html">routes/menu=board</a></li><li><a href="module-routes_newCashier.html">routes/newCashier</a></li><li><a href="module-routes_prep-table.html">routes/prep-table</a></li></ul><h3>Classes</h3><ul><li><a href="Entry.html">Entry</a></li><li><a href="MenuItem.html">MenuItem</a></li><li><a href="Order.html">Order</a></li><li><a href="TotalOrder.html">TotalOrder</a></li><li><a href="module-routes_newCashier-fullEntry.html">fullEntry</a></li></ul><h3>Global</h3><ul><li><a href="global.html#GetLoginScreen">GetLoginScreen</a></li><li><a href="global.html#GoToManagerReports">GoToManagerReports</a></li><li><a href="global.html#GoToManagerView">GoToManagerView</a></li><li><a href="global.html#GoToProductUsageReport">GoToProductUsageReport</a></li><li><a href="global.html#GoToRestock">GoToRestock</a></li><li><a href="global.html#GoToSalesReport">GoToSalesReport</a></li><li><a href="global.html#GoToXReport">GoToXReport</a></li><li><a href="global.html#GoToZReport">GoToZReport</a></li><li><a href="global.html#PostLoginInfo">PostLoginInfo</a></li><li><a href="global.html#RestockItems">RestockItems</a></li><li><a href="global.html#SetZReportTime">SetZReportTime</a></li><li><a href="global.html#authJWT">authJWT</a></li><li><a href="global.html#calcPrice">calcPrice</a></li><li><a href="global.html#cancelOrder">cancelOrder</a></li><li><a href="global.html#confirmOrder">confirmOrder</a></li><li><a href="global.html#deleteEntry">deleteEntry</a></li><li><a href="global.html#editEntry">editEntry</a></li><li><a href="global.html#entrees">entrees</a></li><li><a href="global.html#getEntreeId">getEntreeId</a></li><li><a href="global.html#goBack">goBack</a></li><li><a href="global.html#limits">limits</a></li><li><a href="global.html#loadSelections">loadSelections</a></li><li><a href="global.html#mealType">mealType</a></li><li><a href="global.html#menuItem">menuItem</a></li><li><a href="global.html#orderMore">orderMore</a></li><li><a href="global.html#pending">pending</a></li><li><a href="global.html#proceed">proceed</a></li><li><a href="global.html#removeNotification">removeNotification</a></li><li><a href="global.html#renderProductUsageChart">renderProductUsageChart</a></li><li><a href="global.html#requestHelp">requestHelp</a></li><li><a href="global.html#selectItem">selectItem</a></li><li><a href="global.html#selectSize">selectSize</a></li><li><a href="global.html#selectedItems">selectedItems</a></li><li><a href="global.html#showPopup">showPopup</a></li><li><a href="global.html#sides">sides</a></li><li><a href="global.html#startOrder">startOrder</a></li><li><a href="global.html#submitCancellation">submitCancellation</a></li><li><a href="global.html#submitOrder">submitOrder</a></li><li><a href="global.html#subs">subs</a></li><li><a href="global.html#validateOrder">validateOrder</a></li><li><a href="global.html#verifyEmployee">verifyEmployee</a></li><li><a href="global.html#viewBag">viewBag</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Wed Dec 10 2025 21:53:57 GMT-0600 (Central Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
